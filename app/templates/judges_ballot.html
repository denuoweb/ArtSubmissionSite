{% extends "base.html" %}
{% block content %}

<h1>Ballot</h1>

{% if current_user.is_admin %}
    <a href="{{ url_for('admin.admin_page') }}" class="btn btn-secondary">Back to Admin Dashboard</a>
{% endif %}

<!-- Logout Form -->
<h2>Logout</h2>
<form method="POST" action="{{ url_for('auth.logout') }}">
    {{ logout_form.csrf_token() }}
    <button type="submit" class="btn btn-danger">Logout</button>
</form>

<!-- Tabs Navigation -->
<ul class="nav nav-tabs" id="ballotTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" aria-selected="true">
            General Submissions
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="youth-tab" data-bs-toggle="tab" data-bs-target="#youth" type="button" role="tab" aria-controls="youth" aria-selected="false">
            Youth Submissions
        </button>
    </li>
</ul>

<!-- Tab Content -->
<div class="tab-content mt-3">
    <!-- General Submissions Tab -->
    <div class="tab-pane show active" id="general" role="tabpanel" aria-labelledby="general-tab">
        <form id="ranking-form" action="{{ url_for('main.judges_ballot') }}" method="POST">
            {{ rank_form.hidden_tag() }}
            <input type="hidden" id="rank-input" name="rank">
            <input type="hidden" name="form_name" value="ranking_form">
            <div id="rankings-list" class="sortable-list">
                {% for submission in artist_submissions %}
                <div class="rank-item" data-id="{{ submission.id }}">
                    <span class="rank-position"></span> {{ submission.name }}
                </div>
                {% endfor %}
            </div>
            <button type="submit" class="btn btn-primary mt-3">Submit Rankings</button>
        </form>
    </div>

    <!-- Youth Submissions Tab -->
    <div class="tab-pane" id="youth" role="tabpanel" aria-labelledby="youth-tab">
        <form id="youth-ranking-form" action="{{ url_for('main.judges_ballot') }}" method="POST">
            {{ rank_form.hidden_tag() }}
            <input type="hidden" id="youth-rank-input" name="rank">
            <input type="hidden" name="form_name" value="youth_ranking_form">
            <div id="youth-rankings-list" class="sortable-list">
                {% for submission in youth_submissions %}
                <div class="rank-item" data-id="{{ submission.id }}">
                    <span class="rank-position"></span> {{ submission.name }}
                </div>
                {% endfor %}
            </div>
            <button type="submit" class="btn btn-primary mt-3">Submit Youth Rankings</button>
        </form>
    </div>
</div>

<!-- Artwork Modal -->
<div id="artworkModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="artworkModalTitle">Artwork Detail</h5>
            <button type="button" class="custom-close-btn" aria-label="Close" onclick="closeArtworkModal(); return false;">Ã—</button>
        </div>
        <div class="modal-body">
            <ul class="list-group">
                <li class="list-group-item"><strong>Submitter Name:</strong> <span id="modalSubmitterName"></span></li>
                <li class="list-group-item"><strong>Email:</strong> <span id="modalEmail"></span></li>
                <li class="list-group-item"><strong>Artist Bio:</strong> <span id="modalArtistBio"></span></li>
                <li class="list-group-item"><strong>Portfolio Link:</strong> <a id="modalPortfolioLink" href="" target="_blank"></a></li>
                <li class="list-group-item"><strong>Statement:</strong> <span id="modalStatement"></span></li>
                <li class="list-group-item"><strong>Cultural Engagement:</strong> <span id="modalCulturalEngagement"></span></li>
                <li class="list-group-item"><strong>Community Impact:</strong> <span id="modalCommunityImpact"></span></li>
                <li class="list-group-item"><strong>Sustainability Importance:</strong> <span id="modalSustainability"></span></li>
                <li class="list-group-item"><strong>Demographic Identity:</strong> <span id="modalDemographic"></span></li>
                <li class="list-group-item"><strong>Lane County Connection:</strong> <span id="modalLaneCounty"></span></li>
                <li class="list-group-item"><strong>Accessibility Needs:</strong> <span id="modalAccessibility"></span></li>
                <li class="list-group-item"><strong>Future Engagement:</strong> <span id="modalFutureEngagement"></span></li>
                <li class="list-group-item"><strong>Opt-In to Feature All Submitted Artwork?</strong><span id="modalFeaturedOptIn"></span>
                </li>
            </ul>
            <ul id="modalBadgeArtworks" class="list-group mt-3"></ul>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/delete_submission.js') }}"></script>
<script src="{{ url_for('static', filename='js/rankings.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script src="{{ url_for('static', filename='js/artwork_modal.js') }}"></script>
{% endblock %}
